DeviceTvmSoftwareVulnerabilities
| where VulnerabilitySeverityLevel in ("High")
| join kind=inner (
    DeviceTvmSoftwareVulnerabilitiesKB
    | where PublishedDate < ago(30d)
) on CveId
| join kind=inner (
    DeviceInfo
// Uncomment below line to show devices in specific device groups
//    | where MachineGroup in ("Group1", "Group2")
    | distinct DeviceId, DeviceName, MachineGroup
) on DeviceId
| project DeviceName, SoftwareName, SoftwareVersion, CveId, CvssScore, VulnerabilitySeverityLevel, PublishedDate, RecommendedSecurityUpdate, MachineGroup = MachineGroup1
| sort by CvssScore desc
// Uncomment below line to summarize vulns per device
//| summarize Vulnerabilities = count() by DeviceName
// Uncomment below line to summarize by software
//| summarize count() by CveId

